version: "3"
services:
  user:
    image: jasonheshuai/jwt-demo-user
    build: ./user
    volumes:
      - go-modules:/go/pkg/mod
  auth:
    image: jasonheshuai/jwt-demo-auth
    build: ./auth
    volumes:
      - go-modules:/go/pkg/mod
    environment:
      - USER_HOST=user:5040
      - SCOPE_HOST=scope:5040
      - PUB_KEY_PATH=/app.rsa.pub
      - PRI_KEY_PATH=/app.rsa
      - JWKS_PATH=/jwks.json
    ports:
      - 5040:5040
      - 5050:5050
      - 5060:5060
  scope:
    image: jasonheshuai/jwt-demo-scope
    build: ./scope
    volumes:
      - go-modules:/go/pkg/mod
  resource:
    image: jasonheshuai/jwt-demo-resource
    build: ./resource
    volumes:
      - go-modules:/go/pkg/mod
  mysql:
    image: mysql:5.7
    restart: always
    ports:
      - 3306:3306
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: users
      MYSQL_USER: users
      MYSQL_PASSWORD: users
  redis:
    image: redis:alpine
    ports:
      - 6379:6379
volumes:
  go-modules: